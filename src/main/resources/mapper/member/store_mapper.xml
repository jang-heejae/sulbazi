<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="com.sulbazi.member.StoreDAO">
	<select id="getStoreDetail" parameterType="int" resultType="com.sulbazi.member.StoreDTO">
		select * from store where store_idx = #{idx}
	</select>
	<select id="getStorePhoto" parameterType="int" resultType="com.sulbazi.photo.PhotoDTO">
		select new_filename from photo where photo_folder_idx=#{idx} and photo_category_idx=1
	</select>
	<select id="getStorePhotos" parameterType="int" resultType="com.sulbazi.photo.PhotoDTO">
		select new_filename from photo where photo_folder_idx=#{idx} and photo_category_idx=7 ORDER BY photo_idx ASC
	</select>
	<select id="fileList" parameterType="int" resultType="com.sulbazi.photo.PhotoDTO">
		SELECT p.new_filename
		FROM photo p
		JOIN store_menu m ON m.menu_idx = p.photo_folder_idx
		WHERE m.store_idx = #{idx}
		AND m.menu_category = '안주'
		AND p.photo_category_idx = 2
		ORDER BY p.photo_folder_idx ASC;
	</select>
	<select id="alcoholFileList" parameterType="int" resultType="com.sulbazi.photo.PhotoDTO">
		SELECT p.new_filename
		FROM photo p
		JOIN store_menu m ON m.menu_idx = p.photo_folder_idx
		WHERE m.store_idx = #{idx}
		AND m.menu_category = '술'
		AND p.photo_category_idx = 6
		ORDER BY p.photo_folder_idx ASC;
	</select>
	<select id="getStoreMenuById" parameterType="int" resultType="com.sulbazi.member.StoreMenuDTO">
		select menu_name,menu_price from store_menu where store_idx=#{idx} and menu_category='안주' ORDER BY menu_idx ASC
	</select>
	<select id="getStoreAlcohol" parameterType="int" resultType="com.sulbazi.member.StoreMenuDTO">
		select menu_name,menu_price from store_menu where store_idx=#{idx} and menu_category='술' ORDER BY menu_idx ASC
	</select>
	<select id="getBoard" parameterType="int" resultType="com.sulbazi.board.BoardDTO">
		select * from board where store_idx=#{idx} ORDER BY board_date DESC LIMIT 1
	</select>
	<insert id="bookmarkCheck" parameterType="map">
		insert into bookmark (user_id,store_idx)
			values(#{user_id},#{store_idx})
	</insert>
	<select id="bookmarkCheckCount" parameterType="map" resultType="int">
		select count(user_id) from bookmark where store_idx=#{store_idx}
	</select>
	<select id="storeBookmarkCheck" parameterType="map" resultType="int">
		select count(store_idx) from bookmark where store_idx=#{store_idx}
	</select>
	<delete id="delBookmark" parameterType="map">
		DELETE FROM bookmark WHERE user_id = #{user_id} and store_idx = #{store_idx};
	</delete>
	<update id="updateStoreFavoriteCount" parameterType="int">
		UPDATE store SET bookmark_user = #{bookmark_user} WHERE store_idx = #{store_idx};
	</update>
	<select id="stCategory" parameterType="int" resultType="int">
	    SELECT opt_idx 
	    FROM store_category 
	    WHERE store_idx = #{idx}
	    ORDER BY opt_idx ASC	
	</select>
	<select id="storeByCategoryopt" resultType="com.sulbazi.category.CategoryOptDTO">
		select * from category_opt where opt_idx=#{param1}
	</select>



	<!-- 매장 이름 검색 후 store_idx 추출-->
	<select id="storenamesearch" resultType="int">
		SELECT store_idx FROM store 
			WHERE store_name LIKE CONCAT('%', #{param1}, '%')
	</select>

	<!-- 매장 메뉴 검색 후 store_idx 추출-->
	<select id="storemenusearch" resultType="int">
		SELECT store_idx FROM store_menu 
			WHERE menu_name LIKE CONCAT('%', #{param1}, '%') GROUP BY store_idx
	</select>

	<!-- 매장 주소 검색 후 store_idx 추출-->
	<select id="storeaddrsearch" resultType="int">
		SELECT store_idx FROM store WHERE store_address LIKE CONCAT('%', #{param1}, '%')
	</select>

	<select id="storesearch" resultType="com.sulbazi.member.StoreDTO">
		SELECT store_name,star_average,review_total,store_address FROM store WHERE store_idx=#{param1}
	</select>
	

</mapper>