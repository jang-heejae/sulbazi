<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="com.sulbazi.review.ReviewDAO">
	<!-- 신고 당한 리뷰 내용 내용뽑아오기 -->
	<select id="reportedIdx" parameterType="int" resultType="String">
    	SELECT review_content FROM review WHERE review_idx = #{reported_idx}
	</select>
	
	<!-- 리뷰 가져오기 내림차순 조인 4 개 리뷰 좋아요 까지 포함됨  -->
	<select id="getReviewAlluser" parameterType="int" resultType="com.sulbazi.review.ReviewDTO">
    SELECT 
        r.review_idx,
        r.store_idx,
        r.review_content,
        r.review_date,
        r.starpoint,
        r.review_state,
        u.user_nickname,
        u.user_likecount,
        u.user_photo,
        rc.comm_date,
        rc.comm_content,
        COUNT(rl.user_id) AS like_count
    FROM 
        review as r
    INNER JOIN 
        user as u ON r.user_id = u.user_id
    LEFT JOIN 
        review_comm as rc ON r.review_idx = rc.review_idx
    LEFT JOIN 
        review_like as rl ON r.review_idx = rl.review_idx
    WHERE 
        r.store_idx = #{param1}
    GROUP BY 
        r.review_idx, r.store_idx, r.review_content, r.review_date, r.starpoint, r.review_state, 
        u.user_nickname, u.user_likecount, u.user_photo, rc.comm_date, rc.comm_content
    ORDER BY 
        r.review_idx DESC
	</select>

	
	
	
</mapper>