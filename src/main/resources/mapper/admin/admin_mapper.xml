<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<mapper namespace="com.sulbazi.admin.AdminDAO">
	<insert id="adminAdd" parameterType="com.sulbazi.admin.AdminDTO">
		INSERT INTO admin(admin_id, admin_pw, admin_name)
			VALUES(#{admin_id}, #{admin_pw}, #{admin_name})
	</insert>
	<select id="adminList" parameterType="com.sulbazi.admin.AdminDTO">
		SELECT * FROM admin ORDER BY admin_doc ASC
	</select>
	<update id="adminUpdate" parameterType="map">
		UPDATE admin SET admin_pw = #{new_password} WHERE admin_id = #{admin_id}
	</update>
	<select id="adminChange" parameterType="String">
		SELECT * FROM admin WHERE admin_id = #{admin_id}
	</select>
	<select id="getAdminNameById" parameterType="String" resultType="String">
    	SELECT admin_name FROM admin WHERE admin_id = #{admin_id}
	</select>
	<select id="adminUserList">
		SELECT * FROM user ORDER BY user_date DESC LIMIT #{param1} OFFSET #{param2}
	</select>
	<select id="userCount" resultType="int">
		SELECT CEIL(COUNT(user_id)/#{param1}) FROM user
	</select>
	<select id="adminStoreList">
		SELECT * FROM store ORDER BY store_idx DESC LIMIT #{param1} OFFSET #{param2}
	</select>
	<select id="storeCount" resultType="int">
		SELECT CEIL(COUNT(store_idx)/#{param1}) FROM store
	</select>
	<select id="adminUserDetail" resultType="com.sulbazi.member.UserDTO">
    	SELECT 
        	u.*, 
        	r.revoke_start, 
        	r.revoke_stop,
        	co.opt_name  -- category_opt에서 가져오는 option_name
    	FROM 
        	user u
    	LEFT JOIN 
        	revokes r ON u.user_id = r.user_id
    	LEFT JOIN 
        	user_category uc ON u.user_id = uc.user_id
    	LEFT JOIN 
        	category_opt co ON uc.opt_idx = co.opt_idx  -- option_idx로 category_opt와 연결
    	WHERE 
        	u.user_id = #{user_id}
</select>
</mapper>